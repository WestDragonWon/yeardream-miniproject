# Kubernetes ConfigMap

**ConfigMap**은 Kubernetes에서 설정 파일, 환경 변수 또는 구성 데이터를 저장하고 파드에 제공하는 방법을 제공합니다. 파드는 이를 사용해 설정을 동적으로 관리하며, 애플리케이션의 소스 코드와 별개로 구성 데이터를 관리할 수 있습니다. 이를 통해 같은 이미지를 유지하면서도 다양한 환경에서 애플리케이션을 실행할 수 있습니다.

## 1. ConfigMap의 개념

**ConfigMap**은 구성 데이터를 키-값 쌍으로 저장하는 객체입니다. 이러한 데이터를 파드에 주입함으로써 환경 설정을 변경하거나, 파일 형태의 설정을 사용할 수 있습니다. ConfigMap은 코드와 분리된 설정 데이터를 제공하여, 애플리케이션의 가동 중에도 손쉽게 설정을 관리할 수 있게 해줍니다.

- **용도**: 환경 변수, 명령줄 인수, 설정 파일 등의 데이터를 저장하고 관리
- **장점**: 애플리케이션의 코드와 설정을 분리하여 유연한 환경 설정 가능

## 2. ConfigMap의 사용 사례

ConfigMap은 여러 가지 방식으로 사용될 수 있습니다. 주요 사용 사례는 다음과 같습니다.

### 2.1 환경 변수 설정
ConfigMap을 사용해 파드 내에서 사용할 환경 변수를 설정할 수 있습니다. 예를 들어, 데이터베이스 연결 정보, API 키, 로그 레벨 등을 설정하는 데 사용됩니다.

### 2.2 설정 파일 제공
애플리케이션이 특정 형식의 설정 파일을 필요로 하는 경우, ConfigMap을 사용해 설정 파일을 관리할 수 있습니다. 이를 통해 설정 파일을 파드에 마운트하고 애플리케이션에서 이를 읽어들여 사용할 수 있습니다.

### 2.3 명령줄 인수
파드의 명령줄 인수로 ConfigMap 데이터를 제공하여, 동적으로 애플리케이션의 동작을 제어할 수 있습니다.

## 3. ConfigMap의 주요 활용 예시

### 3.1 Airflow ConfigMap

Airflow는 워크플로 관리 도구로, 다양한 설정을 필요로 합니다. ConfigMap을 사용하여 Airflow의 DAG 디렉토리 경로, 실행기 타입, 데이터베이스 연결 정보, 로그 레벨 등을 설정할 수 있습니다. 이를 통해 코드 수정 없이 환경 설정을 조정할 수 있습니다.

- **환경 변수 예시**: 
  - `AIRFLOW__CORE__DAGS_FOLDER`: DAGs 폴더 경로
  - `AIRFLOW__CORE__EXECUTOR`: 실행기 설정 (예: KubernetesExecutor)
  - `AIRFLOW__DATABASE__SQL_ALCHEMY_CONN`: 데이터베이스 연결 문자열

### 3.2 Alertmanager ConfigMap

Alertmanager는 Prometheus와 함께 알람을 관리하는 시스템입니다. ConfigMap을 사용해 Slack과 같은 알람 수신 도구의 설정을 관리할 수 있습니다. 알람 그룹화, 알람 발송 간격 및 알람 수신자 정보를 설정할 수 있습니다.

- **주요 설정 항목**:
  - `slack_api_url`: Slack 알림을 보낼 웹훅 URL
  - `group_by`: 알람을 그룹화하는 기준 (예: `alertname`, `instance`)
  - `repeat_interval`: 동일 알람을 다시 보낼 시간 간격

### 3.3 Prometheus ConfigMap

Prometheus는 모니터링 및 경고 시스템으로, 다양한 애플리케이션 메트릭을 수집합니다. ConfigMap을 사용해 Prometheus의 스크랩 인터벌, 모니터링할 타겟 정보, 알람 설정 등을 구성할 수 있습니다. 또한, PostgreSQL, Kafka, Redis, MongoDB 등의 exporter와 통합하여 다양한 시스템을 모니터링할 수 있습니다.

- **주요 설정 항목**:
  - `scrape_interval`: 메트릭을 수집하는 주기
  - `alerting`: 알람 관리 대상 설정 (예: Alertmanager)
  - `scrape_configs`: 모니터링할 서비스 정보

### 3.4 Postgres ConfigMap

PostgreSQL 데이터베이스의 접근 제어 설정인 `pg_hba.conf` 파일을 관리할 때, ConfigMap을 사용할 수 있습니다. 모든 IP 주소로부터의 접속을 허용하도록 설정을 추가하는 방식으로, ConfigMap을 사용하여 파일을 동적으로 관리할 수 있습니다.

- **주요 설정 항목**:
  - `pg_hba.append.conf`: `pg_hba.conf` 파일에 추가될 IP 접근 제어 규칙

## 4. ConfigMap의 장점

1. **환경 분리**: 같은 애플리케이션을 여러 환경에서 쉽게 실행할 수 있도록, ConfigMap을 통해 환경에 맞는 설정을 주입할 수 있습니다.
2. **유연성**: 파드에 대한 설정을 코드와 분리함으로써, 설정 변경을 위해 애플리케이션을 다시 빌드하지 않아도 됩니다.
3. **재사용성**: 동일한 ConfigMap을 여러 파드에 적용할 수 있어, 일관된 설정 관리를 제공합니다.
4. **보안**: 중요한 데이터는 ConfigMap이 아닌 **Secret**을 사용해야 하지만, 비민감한 구성 데이터를 안전하게 관리할 수 있습니다.

## 5. ConfigMap과 Secret의 차이점

ConfigMap은 비밀 데이터를 저장하는 용도로 사용하지 않아야 합니다. 대신 비밀번호, 인증 토큰 등 민감한 정보는 **Secret**을 사용해야 하며, ConfigMap은 일반적인 설정 정보 관리에 적합합니다. Secret은 Base64로 인코딩된 데이터를 저장하여 보안성을 강화합니다.

## 6. ConfigMap의 활용 전략

- 설정이 자주 변경되는 경우 ConfigMap을 통해 환경 변수를 업데이트하거나 파일을 변경함으로써 애플리케이션의 동작을 유연하게 제어할 수 있습니다.
- ConfigMap은 애플리케이션의 코드와 설정을 분리하는 중요한 도구로, 특히 마이크로서비스 아키텍처에서 유용합니다.

